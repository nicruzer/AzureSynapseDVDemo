{
	"name": "DROP_CREATE_vw_STG_kaggle_superhero",
	"properties": {
		"folder": {
			"name": "Views"
		},
		"content": {
			"query": "IF OBJECT_ID('stage1.vw_STG_kaggle_superhero_base') IS NOT NULL \n    DROP VIEW stage1.vw_STG_kaggle_superhero_base\nGO\n\nCREATE VIEW stage1.vw_STG_kaggle_superhero_base\nAS\nSELECT sks.[name],\n       sks.[real_name],\n       sks.full_name,\n       sks.overall_score,\n       LEFT(sks.history_text, 8000) AS history_text, -- To allow for clustered columnstore index\n       sks.powers_text,\n       sks.intelligence_score,\n       sks.strength_score,\n       sks.speed_score,\n       sks.durability_score,\n       sks.power_score,\n       sks.combat_score,\n       sks.place_of_birth,\n       sks.first_appearance,\n       sks.creator,\n       sks.alignment,\n       sks.occupation,\n       sks.base,\n       sks.gender,\n       sks.type_race,\n       sks.height,\n       sks.weight,\n       sks.eye_color,\n       sks.hair_color,\n       sks.skin_color,\n       sks.img,\n       sks.has_electrokinesis,\n       sks.has_energy_constructs,\n       sks.has_mind_control_resistance,\n       sks.has_matter_manipulation,\n       sks.has_telepathy_resistance,\n       sks.has_mind_control,\n       sks.has_enhanced_hearing,\n       sks.has_dimensional_travel,\n       sks.has_element_control,\n       sks.has_size_changing,\n       sks.has_fire_resistance,\n       sks.has_fire_control,\n       sks.has_dexterity,\n       sks.has_reality_warping,\n       sks.has_illusions,\n       sks.has_energy_beams,\n       sks.has_peak_human_condition,\n       sks.has_shapeshifting,\n       sks.has_heat_resistance,\n       sks.has_jump,\n       sks.[has_self-sustenance],\n       sks.has_energy_absorption,\n       sks.has_cold_resistance,\n       sks.has_magic,\n       sks.has_telekinesis,\n       sks.has_toxin_and_disease_resistance,\n       sks.has_telepathy,\n       sks.has_regeneration,\n       sks.has_immortality,\n       sks.has_teleportation,\n       sks.has_force_fields,\n       sks.has_energy_manipulation,\n       sks.has_endurance,\n       sks.has_longevity,\n       sks.[has_weapon-based_powers],\n       sks.has_energy_blasts,\n       sks.has_enhanced_senses,\n       sks.has_invulnerability,\n       sks.has_stealth,\n       sks.has_marksmanship,\n       sks.has_flight,\n       sks.has_accelerated_healing,\n       sks.has_weapons_master,\n       sks.has_intelligence,\n       sks.has_reflexes,\n       sks.has_super_speed,\n       sks.has_durability,\n       sks.has_stamina,\n       sks.has_agility,\n       sks.has_super_strength\nFROM stage1.STG_kaggle_superhero sks\nGO\n\nIF OBJECT_ID('stage1.vw_STG_kaggle_superhero_superpowers') IS NOT NULL\n    DROP VIEW stage1.vw_STG_kaggle_superhero_superpowers\nGO\n\nCREATE VIEW stage1.vw_STG_kaggle_superhero_superpowers\nAS \n\nWITH clean AS (\n    SELECT sks.[name],\n        REPLACE(sks.superpowers,'''','\"') AS superpowers\n    FROM stage1.STG_kaggle_superhero sks\n)\n\nSELECT c.[name], jd.superpower\nFROM clean c\n    CROSS APPLY OPENJSON(c.superpowers)\n        WITH (\n            superpower VARCHAR(256) '$'\n        ) AS jd\n\nGO\n\nIF OBJECT_ID('stage1.vw_STG_kaggle_superhero_alter_egos') IS NOT NULL\n    DROP VIEW stage1.vw_STG_kaggle_superhero_alter_egos\nGO\n\nCREATE VIEW stage1.vw_STG_kaggle_superhero_alter_egos\nAS \n\nWITH clean AS (\n    SELECT sks.[name],\n        REPLACE (\n            REPLACE(\n                REPLACE(\n                    REPLACE(sks.alter_egos,'[''','[\"'), ''']', '\"]')\n                    , ''',','\",'\n                ), ', ''', ', \"'\n         ) AS alter_egos\n    FROM stage1.STG_kaggle_superhero sks\n)\n\nSELECT c.[name], jd.[alter_ego]\nFROM clean c\n    CROSS APPLY OPENJSON(c.alter_egos)\n        WITH (\n            [alter_ego] VARCHAR(256) '$'\n        ) AS jd\n\nGO\n\nIF OBJECT_ID('stage1.vw_STG_kaggle_superhero_aliases') IS NOT NULL\n    DROP VIEW stage1.vw_STG_kaggle_superhero_aliases\nGO\n\nCREATE VIEW stage1.vw_STG_kaggle_superhero_aliases\nAS \n\nWITH clean AS (\n    SELECT sks.[name],\n        REPLACE(\n            REPLACE(\n                REPLACE (\n                    REPLACE(\n                        REPLACE(\n                            REPLACE(sks.aliases,'[''',''), ''']', '')\n                            , ''',',','\n                        ), ', ''', ', '\n                ), '[\"',''\n            ), '\"]',''\n        ) AS [alias]\n    FROM stage1.STG_kaggle_superhero sks\n)\n\nSELECT c.[name], jd.[value] AS [alias]\nFROM clean c\n    CROSS APPLY STRING_SPLIT(c.[alias],',') AS jd\nWHERE jd.[value] <> ''\n\nGO\n\nIF OBJECT_ID('stage1.vw_STG_kaggle_superhero_teams') IS NOT NULL\n    DROP VIEW stage1.vw_STG_kaggle_superhero_teams\nGO\n\nCREATE VIEW stage1.vw_STG_kaggle_superhero_teams\nAS\n\nWITH clean AS (\n    SELECT [name], \n            REPLACE (\n                REPLACE(\n                    REPLACE(\n                        REPLACE(sks.teams,'[''','[\"'), ''']', '\"]')\n                        , ''',','\",'\n                    ), ', ''', ', \"'\n            ) AS teams\n    FROM stage1.STG_kaggle_superhero sks\n)\n\nSELECT [name], jd.team\nFROM clean c\n    CROSS APPLY OPENJSON(c.teams)\n        WITH (\n            team VARCHAR(256) '$'\n        ) AS jd\n\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "azuredvsdp",
				"poolName": "azuredvsdp"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}